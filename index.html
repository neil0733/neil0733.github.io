<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>My gallery</title>
		<style>
			body { margin: 0; }
		</style>
	</head>
<body>
<script src="js/three.js"></script>
<script src="js/PointerLockControls.js"></script>
<script>
	const scene = new THREE.Scene();
	//1. camera 設定
	var camera = new THREE.PerspectiveCamera( 45, window.innerWidth / window.innerHeight, 0.1, 1000 );
	camera.position.set(10, 1.7, -10);
	camera.rotation.y = Math.PI;

	//2. renderer 設定
	const renderer = new THREE.WebGLRenderer();
	renderer.setSize( window.innerWidth, window.innerHeight );
	renderer.shadowMap.enabled = true
    renderer.shadowMap.type = 2 // THREE.PCFSoftShadowMap
	document.body.appendChild( renderer.domElement );
	
	//3. 視角控制 設定：使用 Pointer Lock Controls
	const plc = new THREE.PointerLockControls( camera, renderer.domElement );
	//3.1. WASD 控制視角移動，E 控制滑鼠鎖定
	window.addEventListener('keydown', (event)=>{
	let speed = 0.1;
  	switch (event.keyCode) {
  		case 87: // w
   			plc.moveForward(speed);
  		break;
  		case 65: // a
 			plc.moveRight(-speed);
 		break;
  		case 83: // s
  			plc.moveForward(-speed);
   		break;
        case 68: // d
            plc.moveRight(speed);
        break;
		case 69: // e
		    if (plc.isLocked == true) {
				plc.unlock();
			} else {
				plc.lock();
			};
        break;
    }
    });

	//4. 載入 Texture
	const textureLoader = new THREE.TextureLoader();
	//4.1. 載入 地板的 Texture
	const Floorbasecolor = textureLoader.load("./Materials/WoodFlooring/WoodFlooring_basecolor.jpg");
	Floorbasecolor.wrapS = Floorbasecolor.wrapT = THREE.RepeatWrapping;
	Floorbasecolor.repeat.set( 6, 6 );
	const FloornormalMap = textureLoader.load("./Materials/WoodFlooring/WoodFlooring_normalMap.jpg");
	FloornormalMap.wrapS = FloornormalMap.wrapT = THREE.RepeatWrapping;
	FloornormalMap.repeat.set( 6, 6 );
	const FloordisplacementMap = textureLoader.load("./Materials/WoodFlooring/WoodFlooring_displacementMap.jpg");
	FloordisplacementMap.wrapS = FloordisplacementMap.wrapT = THREE.RepeatWrapping;
	FloordisplacementMap.repeat.set( 6, 6 );
	const FloorglossMap = textureLoader.load("./Materials/WoodFlooring/WoodFlooring_glossMap.jpg");
	FloorglossMap.wrapS = FloorglossMap.wrapT = THREE.RepeatWrapping;
	FloorglossMap.repeat.set( 6, 6 );
	//4.2. 載入 自拍照的 Texture
	const Selfybasecolor = textureLoader.load("./Materials/self.jpg");


	//5. 載入 物品
	//5.1. 載入 牆壁
	const Mwall = nnew THREE.MeshLambertMaterial({ color: 0xDAC9A6 });
	const wall1 = new THREE.Mesh(new THREE.PlaneGeometry( 30, 5 ), Mwall);
	wall1.position.set(15, 2.5, 0);
	wall1.rotation.y = -Math.PI / 2;
	scene.add( wall1 );
	const wall2 = new THREE.Mesh(new THREE.PlaneGeometry( 30, 5 ), Mwall);
	wall2.position.set(0, 2.5, 15);
	wall2.rotation.y = Math.PI;
	scene.add( wall2 );
	const wall3 = new THREE.Mesh(new THREE.PlaneGeometry( 10, 5 ), Mwall);
	wall3.position.set(-15, 2.5, 10);
	wall3.rotation.y = Math.PI / 2;
	scene.add( wall3 );
	const wall4 = new THREE.Mesh(new THREE.PlaneGeometry( 20, 5 ), Mwall);
	wall4.position.set(-5, 2.5, 5);
	scene.add( wall4 );
	const wall5 = new THREE.Mesh(new THREE.PlaneGeometry( 20, 5 ), Mwall);
	wall5.position.set(5, 2.5, -5);
	wall5.rotation.y = Math.PI / 2;
	scene.add( wall5 );

	//5.4. 載入 地板
	const Mfloor = new THREE.MeshStandardMaterial({
		map: Floorbasecolor,
		normalMap: FloornormalMap,
		displacementMap: FloordisplacementMap,
		displacementScale: 0.05,
		roughnessMap: FloorglossMap, roughness: 0.25
	});
	const floor = new THREE.Mesh(new THREE.PlaneGeometry( 30, 30 ), Mfloor);
	floor.position.set(0, 0, 0);
	floor.rotation.x = - Math.PI / 2;
	scene.add( floor );
	//5.5. 載入 圓柱
	const cylgeometry = new THREE.CylinderGeometry( 0.4, 0.4, 1, 32 );
	const cylmaterial = new THREE.MeshBasicMaterial( {color: 0x312328 } );
	const cylinder = new THREE.Mesh( cylgeometry, cylmaterial );
	cylinder.position.set(7, 0.5, 7);
	scene.add( cylinder );
	//5.6. 載入 自拍
	const Mselfy = new THREE.MeshStandardMaterial({
		map: Selfybasecolor
	});
	const selfy = new THREE.Mesh(new THREE.PlaneGeometry( 2, 2 ), Mselfy);
	selfy.position.set(14.5, 2.5, -10);
	selfy.rotation.y = -Math.PI / 2;
	scene.add( selfy );
	
	//6. 載入 光線
	const Backgroundlight = new THREE.AmbientLight( 0xFAD689 );
	scene.add( Backgroundlight );
	Backgroundlight.visible = false
	const light = new THREE.PointLight( 0xFAD689, 0.1, 100 );
	light.position.set( 0, 5, 0 );
	scene.add( light );

	function Drawscene(){
		renderer.render( scene, camera );
		window.requestAnimationFrame(Drawscene);
	};
	Drawscene();
</script>
</body>
</html>