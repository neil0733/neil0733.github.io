<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>My gallery</title>
		<style>
			body { margin: 0; }
		</style>
	</head>
<body>
<script src="js/three.js"></script>
<script src="js/PointerLockControls.js"></script>
<script>
	const scene = new THREE.Scene();
	//1. camera 設定
	var camera = new THREE.PerspectiveCamera( 45, window.innerWidth / window.innerHeight, 0.1, 1000 );
	camera.position.set(0, 1.7, 20);

	//2. renderer 設定
	const renderer = new THREE.WebGLRenderer();
	renderer.setSize( window.innerWidth, window.innerHeight );
	document.body.appendChild( renderer.domElement );
	
	//3. 視角控制 設定：使用 Pointer Lock Controls
	const plc = new THREE.PointerLockControls( camera, renderer.domElement );

	//3.1. WASD 控制視角移動
	window.addEventListener('keydown', (event)=>{
	let speed = 0.1;
  	switch (event.keyCode) {
  		case 87: // w
   			plc.moveForward(speed);
  		break;
  		case 65: // a
 			plc.moveRight(-speed);
 		break;
  		case 83: // s
  			plc.moveForward(-speed);
   		break;
        case 68: // d
            plc.moveRight(speed);
        break;
		case 69: // e
		    if (plc.isLocked == true) {
				plc.unlock();
			} else {
				plc.lock();
			};
        break;
    }
    });

	//4. 載入 Texture
	const textureLoader = new THREE.TextureLoader();
	const Floorbasecolor = textureLoader.load("./Materials/WoodFlooring/WoodFlooring_basecolor.jpg");
	Floorbasecolor.wrapS = Floorbasecolor.wrapT = THREE.RepeatWrapping;
	Floorbasecolor.repeat.set( 5, 5 );
	const FloornormalMap = textureLoader.load("./Materials/WoodFlooring/WoodFlooring_normalMap.jpg");
	FloornormalMap.wrapS = FloornormalMap.wrapT = THREE.RepeatWrapping;
	FloornormalMap.repeat.set( 5, 5 );
	const FloordisplacementMap = textureLoader.load("./Materials/WoodFlooring/WoodFlooring_displacementMap.jpg");
	FloordisplacementMap.wrapS = FloordisplacementMap.wrapT = THREE.RepeatWrapping;
	FloordisplacementMap.repeat.set( 5, 5 );
	const FloorglossMap = textureLoader.load("./Materials/WoodFlooring/WoodFlooring_glossMap.jpg");
	FloorglossMap.wrapS = FloorglossMap.wrapT = THREE.RepeatWrapping;
	FloorglossMap.repeat.set( 5, 5 );


	//5. 載入 物品
	const Gfrontwall = new THREE.BoxGeometry( 10, 5, 0.5 );
	const Mfrontwall = new THREE.MeshBasicMaterial( { color: 0xaaaaaa } );
	const frontwall = new THREE.Mesh( Gfrontwall, Mfrontwall );
	frontwall.position.set(0, 2.5, 0);
	scene.add( frontwall );
	const Gleftwall = new THREE.BoxGeometry( 0.5, 5, 20 );
	const Mleftwall = new THREE.MeshBasicMaterial( { color: 0xaaaaaa } );
	const leftwall = new THREE.Mesh( Gleftwall, Mleftwall );
	leftwall.position.set(-5, 2.5, 10);
	scene.add( leftwall );
	const Grightwall = new THREE.BoxGeometry( 0.5, 5, 20 );
	const Mrightwall = new THREE.MeshBasicMaterial( { color: 0xaaaaaa } );
	const rightwall = new THREE.Mesh( Grightwall, Mrightwall );
	rightwall.position.set(5, 2.5, 10);
	scene.add( rightwall );
	//5.4. 載入 地板
	const Mfloor = new THREE.MeshStandardMaterial({
		map: Floorbasecolor,
		normalMap: FloornormalMap,
		displacementMap: FloordisplacementMap,
		displacementScale: 0.05,
		roughnessMap: FloorglossMap, roughness: 0.25
	});
	const floor = new THREE.Mesh(new THREE.PlaneGeometry( 10, 20 ), Mfloor);
	floor.position.set(0, 0, 10);
	floor.rotation.x = - Math.PI / 2;
	scene.add( floor );
	//5.5. 載入 圓柱
	const cylgeometry = new THREE.CylinderGeometry( 0.4, 0.4, 1, 32 );
	const cylmaterial = new THREE.MeshBasicMaterial( {color: 0x312328 } );
	const cylinder = new THREE.Mesh( cylgeometry, cylmaterial );
	cylinder.position.set(2, 0.5, 5);
	scene.add( cylinder );

	const light = new THREE.PointLight( 0xffffff, 0.5, 100 );
	light.position.set( 0, 5, 10 );
	scene.add( light );


	function Drawscene(){
		renderer.render( scene, camera );
		window.requestAnimationFrame(Drawscene);
	};
	Drawscene();
</script>
</body>
</html>