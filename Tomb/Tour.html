<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>南山公墓x元宇宙</title>
		<style>
			body { margin: 0; }	
			#dialog {
			    position: absolute;
				left: 50%;
				top: 85%;
				transform: translate(-50%, -50%);
				width: 80%;
				height: 20%;
				background-color: rgba(0, 0, 0, 0.5);
				border:  8px solid white;
				border-radius: 12px;
				color: #ffffff;
				text-align: center;
				font-size: 40px;
				display: -webkit-box;
				-webkit-box-pack: center;
				-webkit-box-align: center;
			}
			.button {
				color: white;
				font-size: 40px;
				cursor: pointer;
				background-color: rgba(240, 240, 240, 0.2);
				border:  0px solid white;
			}
			.button:hover {
				background-color: rgba(240, 240, 240, 0.7);
			}
		</style>
	</head>

<body>
<div id="dialog">
    <table width="100%">
        <tr>
            <td width="90%"><span id="DialogText">歡迎光臨南山公墓 × 元宇宙</span></td>
            <td width="10%">
			    <button type="button" class="button" id="Back" onclick="NextBack(this)">▲</button><br>
				<button type="button" class="button" id="Next" onclick="NextBack(this)">▼</button>
			</td>
        </tr>
	</table>
</div>
<div id="transition"></div>

<script src="https://neil0733.github.io/js/three.js"></script>
<script src="https://neil0733.github.io/js/PointerLockControls.js"></script>
<script src="https://neil0733.github.io/js/GLTFLoader.js"></script>
<script src="https://neil0733.github.io/js/CSS2DRenderer.js"></script>
<script src="https://neil0733.github.io/js/SVGLoader.js"></script>
<script src="https://neil0733.github.io/js/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/2.0.2/anime.min.js"></script>
<script>
	const scene = new THREE.Scene();
	//1. camera 設定
	var camera = new THREE.PerspectiveCamera( 60, window.innerWidth / window.innerHeight, 0.1, 1000 );

	camera.rotation.set(Math.PI/4, Math.PI/4*3, -Math.PI/6);

	//2. renderer 設定
	const renderer = new THREE.WebGLRenderer();
	renderer.setSize( window.innerWidth, window.innerHeight );
	renderer.shadowMap.enabled = true
    renderer.shadowMap.type = 2 // THREE.PCFSoftShadowMap
	document.body.appendChild( renderer.domElement );
	
	//3. 視角控制 設定：使用 Pointer Lock Controls
	const plc = new THREE.PointerLockControls( camera, renderer.domElement );

	//3.1. 導覽文字、動畫：
	gsap.fromTo(camera.position,{x:25, y:5, z:0}, {x:13, y:5, z:-12, duration:10})
	var i = 0;
	const DialogText = document.getElementById("DialogText");
	function NextBack(Choice){
		if(Choice.id == "Next"){
			var music = new Audio('https://neil0733.github.io/Tomb/Next.mp3');
			music.play();
			i = i + 1;
		} else{
			var Backmusic = new Audio('https://neil0733.github.io/Tomb/Back.mp3');
			Backmusic.play();
			i = i - 1;
		};
		switch (i) {
		    case 0:
			    DialogText.innerText = "歡迎光臨南山公墓 × 元宇宙"
				gsap.to(camera.rotation, {x:Math.PI/4, y:Math.PI/4*3, z:-Math.PI/6, duration:0.01})
				gsap.fromTo(camera.position,{x:25, y:5, z:0}, {x:13, y:5, z:-12, duration:10})
			break
			case 1: 
			    DialogText.innerText = "在這裡，我們將會帶領你了解南山公墓的文化與墓葬特色"
				gsap.to(camera.rotation, {x:0, y:Math.PI, z:0, duration:0.01})
				gsap.fromTo(camera.position, {x:5, y:1.7, z:-12}, {x:5, y:1.7, z:-9, duration:6})
			break
			case 2: 
			    DialogText.innerText = "首先，我們先來看看什麼是南山公墓"
				gsap.fromTo(camera.position, {x:5, y:1.7, z:-9}, {x:12, y:1.7, z:-15, duration:2.5})
			break
			case 3: 
			    DialogText.innerText = "南山公墓：位於台南南區桶盤淺一帶，是原臺灣府城的南郊，為全台最大墓葬群"
			break
			case 4: 
			    DialogText.innerText = "包含了荷治、明鄭、清領、日治到戰後各個時期的墓葬，是台灣歷史的見證"
			break
			case 5: 
			    DialogText.innerText = "其中的墓葬形式，有傳統漢式、日式、天主教式、基督教式、佛教式，更有全世界獨有的日漢合併的墓葬形式"
			break
			case 6: 
			    DialogText.innerText = "蘊含豐富的墓葬建築、古道地貌、軍事遺構、歷史名人、生態環境、考古遺址、文人詩詞、彩繪花磚、石雕作品"
			break
			case 7: 
			    DialogText.innerText = "但近年來，南山墓群因為都市更新等因素，面臨迫遷的危機"
				gsap.to(camera.rotation, {x:0, y:Math.PI/2, z:0, duration:0.01})
				gsap.fromTo(camera.position, {x:5, y:1.7, z:-14}, {x:5, y:1.7, z:-5, duration:6})
			break
			case 8: 
			    DialogText.innerText = "也因為人們固有對於死亡的恐懼，逐漸被大家遺忘"
				gsap.to(camera.rotation, {x:0, y:Math.PI, z:0, duration:0.01})
				gsap.fromTo(camera.position, {x:0.5, y:0.8, z:-15}, {x:-0.5, y:0.8, z:-15, duration:6})
			break
			case 9: 
			    DialogText.innerText = "這個企劃以3D虛擬實境網站展示明代至民國時期代具表性的墓葬建築，帶領大家了解四百多年來台灣喪葬文化的演變"
				gsap.to(camera.rotation, {x:-Math.PI/12, y:0, z:0, duration:0.01})
				gsap.fromTo(camera.position, {x:10, y:4, z:25}, {x:-10, y:4, z:25, duration:10})
			break
			case 10: 
			    DialogText.innerText = "讓我們先從漢人墓葬開始吧！"
			break
			case 11: 
			    DialogText.innerText = "先來介紹一下這個墓的主人：施瓊芳"
			break
			case 12: 
			    DialogText.innerText = "施瓊芳，原名為施龍文，在中舉之後即改名為施瓊芳"
			break
			case 13: 
			    DialogText.innerText = "關於施瓊芳的一些小知識："
			break
			case 14: 
			    DialogText.innerText = "在經歷了四次的會試未中，終於在1845年考中進士，是府城的第一位進士"
			break
			case 15: 
			    DialogText.innerText = "未在分發時赴任江蘇等地的職位，最後返鄉為鄉努力；曾勸募修建育嬰堂、義民祠、藥王廟等公共設施"
			break
			case 16: 
			    DialogText.innerText = "與兒子施士洁是臺灣科舉史上唯一的父子檔進士"
			break
			case 17: 
			    DialogText.innerText = "目前施瓊芳之墓被台南市政府，選定為直轄市古蹟"
			break
			case 18: 
			    DialogText.innerText = "介紹完墓主人，接著就讓我們來看看「漢式墓」的相關構造與介紹吧！"
			break
			
		}	
	}

	//4. 載入 Texture
	const textureLoader = new THREE.TextureLoader();
	//4.1. 載入 地板的 Texture
	const Floorbasecolor = textureLoader.load("https://neil0733.github.io/Tomb/WoodFloor/WoodFlooring_basecolor.jpg");
	Floorbasecolor.wrapS = Floorbasecolor.wrapT = THREE.RepeatWrapping;
	Floorbasecolor.repeat.set( 20, 20 );
	const FloornormalMap = textureLoader.load("https://neil0733.github.io/Tomb/WoodFloor/WoodFlooring_normalMap.jpg");
	FloornormalMap.wrapS = FloornormalMap.wrapT = THREE.RepeatWrapping;
	FloornormalMap.repeat.set( 20, 20 );
	const FloordisplacementMap = textureLoader.load("https://neil0733.github.io/Tomb/WoodFloor/WoodFlooring_displacementMap.jpg");
	FloordisplacementMap.wrapS = FloordisplacementMap.wrapT = THREE.RepeatWrapping;
	FloordisplacementMap.repeat.set( 20, 20 );
	const FloorglossMap = textureLoader.load("https://neil0733.github.io/Tomb/WoodFloor/WoodFlooring_glossMap.jpg");
	FloorglossMap.wrapS = FloorglossMap.wrapT = THREE.RepeatWrapping;
	FloorglossMap.repeat.set( 20, 20 );

	//5. 載入 物品
	//5.1. 載入 牆壁
	const Mwall = new THREE.MeshStandardMaterial({ color: 0x577C8A, roughness : 0.7});
	const wall1 = new THREE.Mesh(new THREE.PlaneGeometry( 40, 7 ), Mwall);
	wall1.position.set(20, 3.5, 0);
	wall1.rotation.y = -Math.PI / 2;
	scene.add( wall1 );
	const wall2 = new THREE.Mesh(new THREE.PlaneGeometry( 40, 7 ), Mwall);
	wall2.position.set(0, 3.5, 20);
	wall2.rotation.y = Math.PI;
	scene.add( wall2 );
	const wall3 = new THREE.Mesh(new THREE.PlaneGeometry( 40, 7 ), Mwall);
	wall3.position.set(-20, 3.5, 0);
	wall3.rotation.y = Math.PI / 2;
	scene.add( wall3 );
	const wall4 = new THREE.Mesh(new THREE.PlaneGeometry( 40, 7 ), Mwall);
	wall4.position.set(0, 3.5, -20);
	scene.add( wall4 );
	//5.2. 載入 天花板
	const Mcelling = new THREE.MeshStandardMaterial({ color: 0x81C7D4 });
	const celling = new THREE.Mesh(new THREE.PlaneGeometry( 40, 40 ), Mcelling);
	celling.position.set(0, 7, 0);
	celling.rotation.x = Math.PI/2;
	scene.add( celling );
	//5.4. 載入 地板
	const Mfloor = new THREE.MeshStandardMaterial({
		map: Floorbasecolor,
		normalMap: FloornormalMap,
		displacementMap: FloordisplacementMap,
		displacementScale: 0.1,
		roughnessMap: FloorglossMap, roughness: 0.6
	});
	const floor = new THREE.Mesh(new THREE.PlaneGeometry( 40, 40 ), Mfloor);
	floor.position.set(0, 0, 0);
	floor.rotation.x = - Math.PI / 2;
	scene.add( floor );
	//5.5.1.1 載入 巴克禮墓
	let loadedModel
	const glftLoader = new THREE.GLTFLoader();
	glftLoader.load(
		'https://neil0733.github.io/Tomb/Barclay.glb', 
		function (gltfScene) {
			loadedModel = gltfScene;
			gltfScene.scene.position.set(15, 0, 10);
			gltfScene.scene.scale.set(0.05, 0.05, 0.05);
			scene.add(gltfScene.scene);
			// 幫巴克禮墓加聚光燈;
			const spotLight = new THREE.SpotLight( 0xffffff, 2, 0, Math.PI/8, 1 ,1.5);
			spotLight.position.set( 12, 2.5, 10 );
			spotLight.castShadow = true;
			spotLight.target = gltfScene.scene;
			scene.add( spotLight );
		}
	)
	//5.5.2 載入 推土機
	let loadedexcavator
	const glftLoader1 = new THREE.GLTFLoader();
	glftLoader1.load(
		'https://neil0733.github.io/Tomb/excavator.glb', 
		function (gltfScene) {
			loadedexcavator = gltfScene;
			gltfScene.scene.rotation.y = 0;
			gltfScene.scene.position.set(0, 1, -5);
			gltfScene.scene.scale.set(1, 1, 1);
			scene.add(gltfScene.scene);
		}
	)
	//5.5.3 載入 護國神山
	let loadmountain
	const glftLoader2 = new THREE.GLTFLoader();
	glftLoader2.load(
		'https://neil0733.github.io/Tomb/mountain.glb', 
		function (gltfScene) {
			loadmountain = gltfScene;
			gltfScene.scene.rotation.y = Math.PI;
			gltfScene.scene.position.set(0.35, 0.1, -13);
			gltfScene.scene.scale.set(0.07, 0.07, 0.07);
			scene.add(gltfScene.scene);
			// 幫護國神山加聚光燈;
			const spotLight = new THREE.SpotLight( 0xffffff, 2, 0, Math.PI/6, 1 ,1.5);
			spotLight.position.set(0, 2, -15);
			spotLight.castShadow = true;
			spotLight.target = gltfScene.scene;
			scene.add( spotLight );
		}
	)
	//5.5.4 載入 王雨卿墓
		let loadWong
	glftLoader.load(
		'https://neil0733.github.io/Tomb/wong.glb', 
		function (gltfScene) {
			loadWong = gltfScene;
			gltfScene.scene.rotation.y = Math.PI/2;
			gltfScene.scene.position.set(0, 0.1, 15);
			gltfScene.scene.scale.set(0.04, 0.04, 0.04);
			scene.add(gltfScene.scene);
			// 幫王雨卿墓加聚光燈;
			const spotLight = new THREE.SpotLight( 0xffffff, 1, 0, Math.PI/6, 1 ,1.5);
			spotLight.position.set(0, 2, 13);
			spotLight.castShadow = true;
			spotLight.target = gltfScene.scene;
			scene.add( spotLight );
		}
	)
	//5.5.5 載入 施瓊芳墓
	let loadSi
	glftLoader.load(
		'https://neil0733.github.io/Tomb/si.glb', 
		function (gltfScene) {
			loadSi = gltfScene;
			gltfScene.scene.rotation.y = Math.PI/4*3;
			gltfScene.scene.position.set(15, 0.6, -15);
			gltfScene.scene.scale.set(0.2, 0.2, 0.2);
			scene.add(gltfScene.scene);
			// 幫施瓊芳墓加聚光燈;
			const spotLight = new THREE.SpotLight( 0xffffff, 2, 0, Math.PI/2, 1 ,1.5);
			spotLight.position.set(15, 2, -15);
			spotLight.castShadow = true;
			spotLight.target = gltfScene.scene;
			scene.add( spotLight );
		}
	)
	//5.6 載入 字板
	//5.6.1 載入 巴克禮
	const svgLoader = new THREE.SVGLoader();
	svgLoader.load(
	// resource URL
	'https://neil0733.github.io/Tomb/Word/Barclay.1.pic.svg',
	// called when the resource is loaded
	function ( data ) {
		const paths = data.paths;
		const group = new THREE.Group();
		group.position.set(19.5, 3.5, 9);
		group.scale.multiplyScalar( 0.01 );
		group.rotation.set(Math.PI, Math.PI/2, 0);

		for ( let i = 0; i < paths.length; i ++ ) {
			const path = paths[ i ];
			const material = new THREE.MeshBasicMaterial( {
				color: 0xffffff,
				side: THREE.DoubleSide,
				depthWrite: false
			} );
			const shapes = THREE.SVGLoader.createShapes( path );
			for ( let j = 0; j < shapes.length; j ++ ) {

				const shape = shapes[ j ];
				const geometry = new THREE.ShapeGeometry( shape );
				const mesh = new THREE.Mesh( geometry, material );
				group.add( mesh );
			}
		}
		scene.add( group );
	}
	);
	svgLoader.load(
	// resource URL
	'https://neil0733.github.io/Tomb/Word/Barclay.2.pic.svg',
	// called when the resource is loaded
	function ( data ) {
		const paths = data.paths;
		const group = new THREE.Group();
		group.position.set(19.5, 3.5, 12);
		group.scale.multiplyScalar( 0.01 );
		group.rotation.set(Math.PI, Math.PI/2, 0);

		for ( let i = 0; i < paths.length; i ++ ) {
			const path = paths[ i ];
			const material = new THREE.MeshBasicMaterial( {
				color: 0xffffff,
				side: THREE.DoubleSide,
				depthWrite: false
			} );
			const shapes = THREE.SVGLoader.createShapes( path );
			for ( let j = 0; j < shapes.length; j ++ ) {

				const shape = shapes[ j ];
				const geometry = new THREE.ShapeGeometry( shape );
				const mesh = new THREE.Mesh( geometry, material );
				group.add( mesh );
			}
		}
		scene.add( group );
	}
	);
	//6. 載入 光線
	const Alight = new THREE.AmbientLight( 0x151515 ); // soft white light
	scene.add( Alight );

	const lightcolor = 0xFAD689;
	const lightstrength = 0.13;
	const light1 = new THREE.PointLight( lightcolor, lightstrength, 100 );
	light1.position.set( 10, 4.5, -10 );
	light1.castShadow = true;
	scene.add( light1 );
	const light2 = new THREE.PointLight( lightcolor, lightstrength, 100 );
	light2.position.set( 10, 4.5, 0 );
	light2.castShadow = true;
	scene.add( light2 );
	const light3 = new THREE.PointLight( lightcolor, lightstrength, 100 );
	light3.position.set( 10, 4.5, 10 );
	light3.castShadow = true;
	scene.add( light3 );
	const light4 = new THREE.PointLight( lightcolor, lightstrength, 100 );
	light4.position.set( 0, 4.5, -10 );
	light4.castShadow = true;
	scene.add( light4 );
	const light5 = new THREE.PointLight( lightcolor, lightstrength, 100 );
	light5.position.set( 0, 4.5, 0 );
	light5.castShadow = true;
	scene.add( light5 );
	const light6 = new THREE.PointLight( lightcolor, lightstrength, 100 );
	light6.position.set( 0, 4.5, 10 );
	light6.castShadow = true;
	scene.add( light6 );
	const light7 = new THREE.PointLight( lightcolor, lightstrength, 100 );
	light7.position.set( -10, 4.5, -10 );
	light7.castShadow = true;
	scene.add( light7 );
	const light8 = new THREE.PointLight( lightcolor, lightstrength, 100 );
	light8.position.set( -10, 4.5, 0 );
	light8.castShadow = true;
	scene.add( light8 );
	const light9 = new THREE.PointLight( lightcolor, lightstrength, 100 );
	light9.position.set( -10, 4.5, 10 );
	light9.castShadow = true;
	scene.add( light9 );

	function Drawscene(){
		renderer.render( scene, camera );
		window.requestAnimationFrame(Drawscene);
	};
	Drawscene();

</script>
</body>
</html>